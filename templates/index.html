<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palloc</title>
    <!-- Add Bootstrap CSS link -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<script src="https://use.fontawesome.com/f59bcd8580.js"></script>
    <!-- Custom CSS for login page -->
    <style>
        body {
            background-color: #f8f9fa;
        #camera-view {
            height: 90%;
            width: 90%;
            ;
        }

        .plate-number {
            font-size: 24px;
            margin-top: 10px;
            align: centre;
        }
        .entering-column {
            max-width: 600px;
            height: 340px;
            margin: 0 auto;
            padding: 20px;
            background-image: linear-gradient(90deg, #C8E6C9, white, white, white, white, white, white, white, white, white, #C8E6C9);
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        }
        .navbar h2,li {
            margin-top: 5px;
        }
        .navbar {
            background-image: linear-gradient(270deg,#20c997, #81D0AE, white);
        }
        .alert {
            background-image: linear-gradient(270deg, #C8E6C9, #C8E6C9, #C8E6C9);
            height: 60px;
        }
    </style>
</head>
<body>
<!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-dark" style="max-height: 56px;">
    <div class="px-4">
        <h2 class="text-black h2">PALLOC</h2>
    </div>
    <div class="flex-grow-1 d-flex justify-content-end with-margin">
    <div class="px-3">
        <ul class="navbar-nav">
            <li class="nav-item">
            
                <a class="nav-link" href="#"><h5 class="text-white h5">Capture</h5></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/display"><h5 class="text-white h5">Dashboard</h5></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/register"><h5 class="text-white h5">Register</h5></a>
            </li>
        </ul>
    </div></div>
    </div>
</nav>
<div class="py-5">
  <div class="container">
    <div class="row no-gutters justify-content-center">
      <!-- 
      <div class="col-md-5 bg-white p-5 entering-column text-center">
        <h1 class="pb-3">ENTERING</h1><hr>
<div class="form-style">
                    <form action = "/" method = "POST">
        <div class="form-group">
                            <label for="number_plate">Number Plate:</label>
                            <input type="number_plate" class="form-control" name="number_plate"id="number_plate" placeholder="Enter number">{{ result }}
                            <button type="submit" class="form-control" name="check" id="check" >Capture</button>
                            {{ text }}
                        </div>
                        </form>
  </div>
        <div class="plate-number" id="entering-plate-number">
            {%for x in number_found%}
                {{x}}
            {%endfor%}
        </div>
      </div>

       Add space between the columns 
      <div class="col-md-1"></div>

     
      <div class="col-md-5 bg-white p-5 entering-column text-center">
        <h1 class="pb-3">EXITING</h1><hr>
        <div class="form-style">
                    <form action = "/exit" method = "POST">
        <div class="form-group">
                            <label for="number_plate">Number Plate:</label>
                            <input type="number_plate" class="form-control" name="number_plate" id="number_plate" placeholder="Enter number">
                            <button type="submit" class="form-control" name="check" id="check" >Capture for exit</button>
                        </div>
                        </form>
  </div>

        <div class="plate-number" id="exiting-plate-number">License Plate: No data</div>
      </div><br>
        {% if get_flashed_messages() %}
            <header>
                <div class="alert mb-0 text-center" role="alert" id="div_flash">
                    {{ get_flashed_messages() | join(" ") }}
                <button type="button" class="btn" onclick="removeFlash()" style="float:right;font-weight:bold;padding-bottom:10px;">X</button>
                </div>
            </header>
        {% endif %}
        -->
    </div>
  </div>
</div>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Feed</title>
    <style>
        *{
            border: 0;
            padding: 0;
            outline: none;
            border: none;
        }
        #video-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        video {
            width: 100%;
            max-width: 640px;
            height: auto;
            border: 1px solid #b67575;
            border-radius: 25px;
            filter: drop-shadow(2px 2px 5px  black);
        }
        
        .buttons{
            display: flex;
            gap: 2em;
            margin-top: 3em ;
        }
        button{
            height: 4em;
            width: 20em;
            border: 1px solid #b67575;
            background-color: transparent;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <!--<form action = "/" method = "POST">
    <div id="video-container">
        <video id="camera-feed" autoplay></video>
        <div class="buttons">
            <button onclick="captureImage()">Capture</button>
            <input type="file" accept="image/*" id="file-input" name="file-input">

        <button type = "submit">Submit</button>
        
        

     
        <button onclick="downloadFile()">Download Selected File</button>
    </div>
    </div>
    </form>-->
    <form action="/" method="POST" id="triangle">
        <input type="text"  name="test" readonly>
        <div id="video-container">
            <video id="camera-feed" autoplay></video>
            <div class="buttons">
                <button onclick="captureImage()" >Capture</button><!-- File input and Capture button -->
                    <input type="file" accept="image/*" id="file-input" name="file-input">
                    
                <!--<button type="submit">Submit</button>-->
                <!-- Download button -->
                <!--<button onclick="downloadFile()">Download Selected File</button>-->
            </div>
        </div>
    </form>



    <!-- Add Bootstrap JavaScript and jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Your custom JavaScript for camera integration and ML goes here -->
    <script>
        // You will need to add JavaScript code for camera access and ML integration here
        // This code is a placeholder and won't actually capture camera feed or license plates
        // It's just to demonstrate the layout.
        
        // Example camera integration (you will need to replace this with actual camera integration code)
        /*
        function startCamera() {
            const cameraView = document.getElementById('camera-view');
            navigator.mediaDevices
                .getUserMedia({ video: { facingMode: "user" }, audio: false })
                .then(function(stream) {
                    cameraView.srcObject = stream;
                })
                .catch(function(error) {
                    console.error("Oops. Something is broken.", error);
                });
        }
        startCamera('entering-camera');
        startCamera('exiting-camera');
        
        // Example license plate number (you will need to replace this with actual ML code)
        function captureLicensePlate(elementId) {
            const plateElement = document.getElementById(elementId);
            // Simulating ML processing
            setTimeout(() => {
                plateElement.textContent = 'License Plate: ABC123';
            }, 2000);
        }
        captureLicensePlate('entering-plate-number');
        captureLicensePlate('exiting-plate-number');
        // Call the cameraStart function to initialize the camera viewer
        startCamera();*/
    </script>

    </script>
    <script>
        const form = document.getElementById("triangle");
        form.addEventListener('submit', e => {
            e.preventDefault()
        })
        function captureImage() {
            const video = document.getElementById("camera-feed");
            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d");

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convert the canvas content to a Blob
            canvas.toBlob(function (blob) {
                // Create a File object from the Blob
                const file = new File([blob], "captured_image.png", { type: "image/png" });

                // Set up a data transfer object
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);

                // Set the files property of the file input by simulating a drop event
                const fileInput = document.getElementById("file-input");
                fileInput.files = dataTransfer.files;

                const fileElement = document.getElementById("file-input")
                const data_form = new FormData(document.getElementById('triangle'))
                data_form.append("file",fileElement.files[0])
                
                console.log(fileElement.files[0])
                console.log(data_form)
                fetch('/upload', {
                    method: 'POST', 
                    body: fileElement.files[0],
                }).then(res => {
                    if(res.status == 200) {
                        return res.text()
                    } else {
                        console.log("Error submitting image: " + res.body.json)
                    }
                }).then(text => {
                    alert(text)
                }).catch(err => {
                    console.log(`Error: ${err}`)
                })

                // this file input now Technically stores the file 
            }, "image/png");
            
        }

        function downloadFile() {
            const fileInput = document.getElementById("file-input");

            if (fileInput.files.length > 0) {
                const selectedFile = fileInput.files[0];
                const downloadLink = document.createElement("a");
                const url = URL.createObjectURL(selectedFile);

                downloadLink.href = url;
                downloadLink.download = selectedFile.name;

                document.body.appendChild(downloadLink);
                downloadLink.click();

                document.body.removeChild(downloadLink);
                URL.revokeObjectURL(url);
            } else {
                alert("Please select a file first.");
            }
        }

        const video = document.getElementById("camera-feed");

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function (stream) {
                    video.srcObject = stream;
                })
                .catch(function (error) {
                    console.error("Error accessing the camera:", error);
                });
        } else {
            console.error("getUserMedia is not supported in this browser.");
        }
    </script>
</body>
</html>